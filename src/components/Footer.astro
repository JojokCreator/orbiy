---
import { useStoryblokApi } from "@storyblok/astro";
import Button from "../components/reusable/Button.astro";
import { Image } from "astro:assets";

let siteConfig;

const sbApi = useStoryblokApi();
try {
  const { data: siteConfigData } = await sbApi.get("cdn/stories/site-config", {
    version:
      import.meta.env.STORYBLOK_LOCAL && import.meta.env.STORYBLOK_PREVIEW
        ? "draft"
        : "published",
    resolve_links: "url",
  });
  siteConfig = siteConfigData.story?.content;
} catch (error) {
  console.error("Error fetching site-config:", error);
}

const {
  footer_logo,
  tagline,
  social_links,
  footer_nav_links_company,
  footer_nav_links_explore,
  waitlist_text,
  waitlist_button,
  copyright,
} = siteConfig || {};
---

<footer class="bg-[#e8e6e3]">
  <div class="max-w-6xl mx-auto px-4 2xl:px-0 py-12">
    <!-- Main Footer Content -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-8 mb-12">
      <!-- Brand Section -->
      <div class="space-y-4 lg:col-span-2">
        {
          tagline && (
            <p class="text-sm leading-relaxed lg:w-2/3 italic">{tagline}</p>
          )
        }
        {
          footer_logo?.filename ? (
            <a href="/">
              <Image
                src={footer_logo.filename}
                alt={footer_logo.alt || "ORBiY Logo"}
                inferSize={true}
                class="h-auto w-32 lg:w-60 object-contain"
              />
            </a>
          ) : (
            <h2 class="text-3xl font-bold tracking-tight">ORBiY</h2>
          )
        }
      </div>
      <!-- Company Links -->
      <div>
        <h3 class="font-semibold mb-4">Company</h3>
        <ul class="space-y-2 text-sm">
          {
            footer_nav_links_company?.map((item: any) => (
              <li>
                <a
                  href={"/" + item.link?.cached_url}
                  class="hover:opacity-70 transition-opacity"
                >
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>
      </div>
      <!-- Explore Links -->
      <div>
        <h3 class="font-semibold mb-4">Explore</h3>
        <ul class="space-y-2 text-sm">
          {
            footer_nav_links_explore?.map((item: any) => (
              <li>
                <a
                  href={"/" + item.link?.cached_url}
                  class="hover:opacity-70 transition-opacity"
                >
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>
      </div>
      <!-- Waitlist Section -->
      <div class="lg:col-span-2">
        <h3 class="font-semibold mb-4">Join The Orbiy Waitlist</h3>
        <p class="text-sm mb-6 leading-relaxed">{waitlist_text}</p>
        <div
          class="flex flex-col lg:flex-row lg:items-center justify-between md:gap-4"
        >
          <Button
            type={waitlist_button?.[0]?.style || "black"}
            buttonText={waitlist_button?.[0]?.text || "START YOUR INQUIRY"}
            link={"/" + waitlist_button?.[0]?.link?.cached_url || "#"}
            class="w-full md:w-auto"
          />
          {
            social_links && social_links.length > 0 && (
              <div class="flex gap-3 pt-2">
                {social_links.map((link: any) => {
                  const url = link.link_target || "#";
                  let href = url;
                  let target = undefined;
                  let rel = undefined;

                  if (url.includes("@") && !url.startsWith("http")) {
                    href = `mailto:${url}`;
                  }

                  if (url.startsWith("https://") || url.startsWith("http://")) {
                    target = "_blank";
                    rel = "noopener noreferrer";
                  }

                  if (href === "#") {
                    target = undefined;
                    rel = undefined;
                  }

                  return (
                    <a
                      href={href}
                      target={target}
                      rel={rel}
                      class="hover:opacity-70 transition-opacity"
                      aria-label={link.link_text}
                    >
                      {link.icon?.filename && (
                        <Image
                          src={link.icon.filename}
                          alt={link.link_text}
                          width={24}
                          height={24}
                          class="w-6 h-6"
                        />
                      )}
                    </a>
                  );
                })}
              </div>
            )
          }
        </div>
      </div>
    </div>
    <!-- Copyright -->
    <div class="border-t border-gray-500 pt-6">
      <p class="text-xs text-center">
        {copyright || "Â© 2025 Orbiy, All rights reserved."}
      </p>
    </div>
  </div>
</footer>
