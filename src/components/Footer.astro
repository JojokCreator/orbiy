---
import { useStoryblokApi } from "@storyblok/astro";
import Button from "../components/reusable/Button.astro";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";

let siteConfig;

// Fetch site-config from Storyblok
const sbApi = useStoryblokApi();
try {
  const { data: siteConfigData } = await sbApi.get("cdn/stories/site-config", {
    version: import.meta.env.DEV ? "draft" : "published",
    resolve_links: "url",
  });
  siteConfig = siteConfigData.story?.content;
} catch (error) {
  console.error("Error fetching site-config:", error);
}

const {
  footer_logo,
  tagline,
  social_links,
  footer_nav_links,
  headquarters_address,
  contact_email,
  contact_phone,
  waitlist_text,
  waitlist_button,
  copyright,
} = siteConfig || {};
---

<footer class="bg-[#e8e6e3] px-6 py-12 md:px-12 lg:px-20">
  <div class="max-w-7xl mx-auto">
    <!-- Main Footer Content -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
      <!-- Brand Section -->
      <div class="space-y-4">
        {
          footer_logo?.filename ? (
            <Image
              src={footer_logo.filename}
              alt={footer_logo.alt || "ORBiY Logo"}
              width={150}
              height={50}
              class="h-auto w-32 object-contain"
            />
          ) : (
            <h2 class="text-3xl font-bold tracking-tight">ORBiY</h2>
          )
        }
        {tagline && <p class="text-sm leading-relaxed">{tagline}</p>}
        {
          social_links && social_links.length > 0 && (
            <div class="flex gap-3 pt-2">
              {social_links.map((link: any, index: number) => (
                <a
                  key={index}
                  href={link.link_target || "#"}
                  class="hover:opacity-70 transition-opacity"
                  aria-label={link.link_text}
                >
                  {link.icon?.filename && (
                    <Image
                      src={link.icon.filename}
                      alt={link.link_text}
                      width={24}
                      height={24}
                      class="w-6 h-6"
                    />
                  )}
                </a>
              ))}
            </div>
          )
        }
      </div>

      <!-- Quick Links -->
      <div>
        <h3 class="font-semibold mb-4">Quick Links</h3>
        <ul class="space-y-2 text-sm">
          {
            footer_nav_links?.map((item: any, index: number) => (
              <li key={index}>
                <a
                  href={item.link?.url || "#"}
                  class="hover:opacity-70 transition-opacity"
                >
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>
      </div>

      <!-- Contact Info -->
      <div>
        <h3 class="font-semibold mb-4">Contact Info</h3>
        <div class="space-y-3 text-sm">
          <div>
            <p class="text-sm leading-relaxed">{headquarters_address}</p>
          </div>
          <div>
            <p class="text-sm leading-relaxed mb-6">
              Mail:{" "}
              <a
                href={`mailto:${contact_email}`}
                class="hover:opacity-70 transition-opacity"
              >
                {contact_email}
              </a>
            </p>
            <div>
              <p class="text-sm leading-relaxed">
                Call:{" "}
                <a
                  href={`tel:+44${contact_phone}`}
                  class="hover:opacity-70 transition-opacity"
                >
                  +44 {contact_phone}
                </a>
              </p>
            </div>
          </div>
        </div>
      </div>
      <!-- Waitlist Section -->
      <div>
        <h3 class="font-semibold mb-4">Join The Orbiy Waitlist</h3>
        <p class="text-sm mb-6 leading-relaxed">{waitlist_text}</p>
        <Button
          type={waitlist_button?.[0]?.style || "filledDark"}
          buttonText={waitlist_button?.[0]?.text || "START YOUR INQUIRY"}
          link={waitlist_button?.[0]?.link?.url || "#"}
          class="w-full md:w-auto"
        />
      </div>
    </div>
    <!-- Copyright -->
    <div class="border-t border-gray-300 pt-6">
      <p class="text-xs text-center">
        {copyright || "Â© 2025 Orbiy, All rights reserved."}
      </p>
    </div>
  </div>
</footer>