---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import Button from './reusable/Button.astro';
import { Icon } from 'astro-icon/components';

interface Props {
  featured?: boolean;
  limit?: number;
}

const { featured = false, limit } = Astro.props;

// Get all cars from the content collection
const allCars = await getCollection('cars');

// Filter cars if featured is true, otherwise show all
const filteredCars = featured
  ? allCars.filter(car => car.data.featured)
  : allCars;

// Limit the number of cars if specified
const cars = limit ? filteredCars.slice(0, limit) : filteredCars;
---

<section class="py-16 lg:py-24">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">

    <!-- Section Header -->
    <div class="text-center mb-16">
      <h2 class="text-3xl font-bold text-gray-900 md:text-4xl lg:text-5xl mb-4">
        {featured ? 'Featured Vehicles' : 'Our Collection'}
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Discover our carefully selected lineup of premium vehicles, each representing the pinnacle of automotive excellence.
      </p>
    </div>

    <!-- Cars Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
      {cars.map((car) => (
        <div class="group relative bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl hover:-translate-y-1">

          <!-- Car Image -->
          <div class="relative h-64 lg:h-72 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent z-10"></div>

            {car.data.image.src ? (
              <img
                src={car.data.image.src}
                alt={car.data.image.alt}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                loading="lazy"
              />
            ) : (
              <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                <span class="text-gray-500">Image Coming Soon</span>
              </div>
            )}

            <!-- Car Info Overlay -->
            <div class="absolute bottom-4 left-4 right-4 z-20">
              <div class="text-white">
                <p class="text-sm font-medium opacity-90">{car.data.brand}</p>
                <h3 class="text-xl font-bold mb-1">{car.data.title}</h3>
                <p class="text-2xl font-bold">{car.data.price}</p>
              </div>
            </div>
          </div>

          <!-- Car Details -->
          <div class="p-6 lg:p-8">

            <!-- Quick Specs -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div class="flex items-center space-x-2">
                <Icon name="engine" class="w-4 h-4 text-gray-400" />
                <span class="text-sm text-gray-600">{car.data.specifications.engine}</span>
              </div>
              <div class="flex items-center space-x-2">
                <Icon name="speed" class="w-4 h-4 text-gray-400" />
                <span class="text-sm text-gray-600">{car.data.specifications.acceleration}</span>
              </div>
              <div class="flex items-center space-x-2">
                <Icon name="power" class="w-4 h-4 text-gray-400" />
                <span class="text-sm text-gray-600">{car.data.specifications.power}</span>
              </div>
              <div class="flex items-center space-x-2">
                <Icon name="fuel" class="w-4 h-4 text-gray-400" />
                <span class="text-sm text-gray-600">{car.data.specifications.fuelType}</span>
              </div>
            </div>

            <!-- Description -->
            <p class="text-gray-600 mb-6 line-clamp-3">
              {car.data.description}
            </p>

            <!-- Features -->
            <div class="mb-6">
              <div class="flex flex-wrap gap-2">
                {car.data.features.slice(0, 3).map((feature) => (
                  <span class="px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full">
                    {feature}
                  </span>
                ))}
                {car.data.features.length > 3 && (
                  <span class="px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full">
                    +{car.data.features.length - 3} more
                  </span>
                )}
              </div>
            </div>

            <!-- CTA Buttons -->
            <div class="flex flex-col sm:flex-row gap-3">
              <Button
                type="filled"
                buttonText="View Details"
                link={`/cars/${car.id}`}
                arrow={true}
                class="flex-1"
              />
              <Button
                type="outline"
                buttonText="Schedule Test Drive"
                link={`/test-drive?car=${car.id}`}
                class="flex-1"
              />
            </div>
          </div>
        </div>
      ))}
    </div>

    <!-- View All Button (if showing featured cars) -->
    {featured && filteredCars.length > 0 && (
      <div class="text-center mt-16">
        <Button
          type="filled"
          buttonText="View All Vehicles"
          link="/cars"
          arrow={true}
          class="mx-auto"
        />
      </div>
    )}
  </div>
</section>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>