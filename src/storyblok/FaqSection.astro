---
import { storyblokEditable, renderRichText } from "@storyblok/astro";
import { Picture } from "astro:assets";
import Button from "../components/reusable/Button.astro";
import { Icon } from "astro-icon/components";

const { blok } = Astro.props;
const { header, title, image, faqs, button } = blok;
---

<section
  class="relative w-screen overflow-hidden bg-teal vertical-p"
  data-faq-section
  {...storyblokEditable(blok)}
>
  <div class="site-container">
    {header && (
      <p class="text-white font-semibold pb-2 md:pb-4">{header}</p>
      <hr class="border-t border-blue-gray h-1 w-full pb-6 md:pb-8" />
    )}
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-16 items-center">
      <div class="space-y-6 h-full">
        <div  class="text-white max-w-lg" set:html={renderRichText(title)} >
        </div>

        {
          image?.filename && (
            <div class="mt-8 rounded-lg overflow-hidden">
              <Picture
                src={image.filename}
                formats={["avif", "webp"]}
                alt={image.alt || title}
                widths={[400, 600, 800]}
                sizes="(max-width: 640px) 100vw, (max-width: 1023px) 384px, 576px"
                inferSize={true}
                class="w-full h-auto object-cover rounded-lg max-w-sm lg:max-w-xl"
              />
            </div>
          )
        }
      </div>
      <div class="order-1 lg:order-2 sm:p-8 md:p-12 rounded-sm">
        <div class="space-y-4">
          {
            faqs?.map(
              (faq: { question: string; answer: string }, index: number) => (
                <details
                  class="group w-full overflow-hidden border-b border-white transition-all duration-300 ease-in-out hover:cursor-pointer"
                  open={index === 0}
                >
                  <summary class="relative flex justify-between items-center py-4 rounded-lg mb-4 text-left cursor-pointer hover:bg-gray-900/30 transition-colors px-2 md:px-4 -mx-2">
                    <div class="flex items-start space-x-3 pr-8">
                      <span class="text-white text-lg sm:text-xl font-medium">
                        0{index + 1}
                      </span>
                      <p class="text-white text-lg sm:text-xl font-medium">
                        {faq.question}
                      </p>
                    </div>
                    <div class="absolute right-2 top-1/2 transform -translate-y-1/2 group-open:rotate-180 transition-transform duration-300">
                      <Icon
                        name="arrow"
                        class="w-5 h-5 md:w-6 md:h-6 text-white"
                      />
                    </div>
                  </summary>
                  <div class="pb-4 px-2">
                    <p class="text-white font-light text-base opacity-90">
                      {faq.answer}
                    </p>
                  </div>
                </details>
              ),
            )
          }
        </div>

        {
          button && (
            <div class="mt-8">
              <Button
                type={button[0].style}
                buttonText={button[0].text}
                link={"/"+button[0].link.cached_url}
              />
            </div>
          )
        }
      </div>
    </div>
  </div>
</section>

<script>
  const detailsElements = document.querySelectorAll(
    "[data-faq-section] details",
  );

  detailsElements.forEach((details, index) => {
    details.addEventListener("toggle", (e) => {
      if ((e.target as HTMLDetailsElement).open) {
        detailsElements.forEach((otherDetails, otherIndex) => {
          if (otherIndex !== index) {
            (otherDetails as HTMLDetailsElement).open = false;
          }
        });
      }
    });
  });
</script>

<style is:global>
  :root {
    interpolate-size: allow-keywords;
  }

  details::details-content {
    block-size: 0;
    transition:
      block-size 300ms,
      content-visibility 300ms;
    transition-behavior: allow-discrete;
  }

  details[open]::details-content {
    block-size: auto;
  }

  /* Ensure smooth animations */
  details summary {
    list-style: none;
    -webkit-user-select: none;
    user-select: none;
  }

  details summary::-webkit-details-marker {
    display: none;
  }
</style>
