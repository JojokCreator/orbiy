---
import { storyblokEditable } from "@storyblok/astro";
import { Icon } from "astro-icon/components";

const { blok } = Astro.props;
const { title, subtitle, address, phone, email, submit_button_text } = blok;
---

<section
  {...storyblokEditable(blok)}
  class="vertical-p bg-teal min-h-screen flex items-center"
>
  <div class="site-container">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16">
      <div class="space-y-8">
        <div class="mb-12">
          {title && <h1 class=" text-white mb-4">{title}</h1>}

          {
            subtitle && (
              <p class="text-lg md:text-xl text-light-gray max-w-3xl mx-auto mb-6">
                {subtitle}
              </p>
            )
          }
        </div>
        <div class="space-y-6">
          <p class="font-medium text-white mb-8">General Enquiries</p>
          {
            phone && (
              <div class="flex items-start justify-start space-x-3">
                <Icon
                  name="phone"
                  class="w-5 h-5 text-gray flex-shrink-0 mt-1.5"
                />
                <div>
                  <p class="font-medium text-white mb-1">Phone</p>
                  <a
                    href={`tel:${phone.replace(/\s+/g, "")}`}
                    class="text-light-gray hover:text-white transition-colors"
                  >
                    {phone}
                  </a>
                </div>
              </div>
            )
          }
          {
            email && (
              <div class="flex items-start justify-start space-x-3">
                <Icon
                  name="email-pen"
                  class="w-5 h-5 text-light-gray flex-shrink-0 mt-1.5"
                />
                <div>
                  <p class="font-medium text-white mb-1">Email</p>
                  <a
                    href={`mailto:${email}`}
                    class="text-light-gray hover:text-white transition-colors"
                  >
                    {email}
                  </a>
                </div>
              </div>
            )
          }
          {
            address && (
              <div class="flex items-start justify-start space-x-3">
                <Icon
                  name="map-pin"
                  class="w-5 h-5 text-light-gray mt-1 flex-shrink-0"
                />
                <div>
                  <p class="font-medium text-white mb-1">Address</p>
                  <p class="text-light-gray whitespace-pre-line">{address}</p>
                </div>
              </div>
            )
          }
        </div>
      </div>
      <div class="lg:border-light-gray lg:border rounded-lg lg:p-8 shadow-lg">
        <form
          class="space-y-6"
          method="POST"
          name="contact"
          data-netlify="true"
          action="/form-success"
          netlify-honeypot="bot-field"
          id="contact-form"
        >
          <input type="hidden" name="bot-field" />
          <input type="hidden" name="form-name" value="contact" />
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label
                for="first_name"
                class="block text-sm font-medium uppercase text-white mb-2"
              >
                First Name *
              </label>
              <input
                type="text"
                id="first_name"
                name="first_name"
                required
                class="w-full px-4 py-3 border border-light-gray bg-light-gray/20 text-white placeholder:text-white rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors"
                placeholder="First name"
              />
            </div>

            <div>
              <label
                for="last_name"
                class="block text-sm font-medium uppercase text-white mb-2"
              >
                Last Name *
              </label>
              <input
                type="text"
                id="last_name"
                name="last_name"
                required
                class="w-full px-4 py-3 border border-light-gray bg-light-gray/20 text-white placeholder:text-white rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors"
                placeholder="Last name"
              />
            </div>
          </div>
          <div>
            <label
              for="email"
              class="block text-sm font-medium uppercase text-white mb-2"
            >
              Email *
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-3 border border-light-gray bg-light-gray/20 text-white placeholder:text-white rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors"
              placeholder="your@email.com"
            />
          </div>
          <div>
            <label
              for="phone"
              class="block text-sm font-medium uppercase text-white mb-2"
            >
              Phone Number
            </label>
            <input
              type="tel"
              id="phone"
              name="phone"
              class="w-full px-4 py-3 border border-light-gray bg-light-gray/20 text-white placeholder:text-white rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors"
              placeholder="+1 (555) 123-4567"
            />
          </div>
          <div>
            <label
              for="message"
              class="block text-sm font-medium uppercase text-white mb-2"
            >
              Message *
            </label>
            <textarea
              id="message"
              name="message"
              required
              rows="6"
              class="w-full px-4 py-3 border border-light-gray bg-light-gray/20 text-white placeholder:text-white rounded-lg focus:ring-2 focus:ring-black focus:border-black transition-colors resize-none"
              placeholder="Your message..."></textarea>
          </div>
          <button
            type="submit"
            class="bg-green whitespace-nowrap active:focus:animate-click relative inline-flex items-center justify-center p-4 px-5 py-3 text-base max-h-12 overflow-hidden text-white rounded-sm transition-all duration-500 ease-in-out hover:bg-dark-green"
          >
            {submit_button_text || "Send Message"}
          </button>
        </form>

        <p class="text-xs text-light-gray mt-4 text-center">
          * Required fields
        </p>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("contact-form") as HTMLFormElement;
    if (form) {
      form.addEventListener("submit", function () {
        const button = form.querySelector('button[type="submit"]') as HTMLButtonElement;
        if (!button) return;

        const originalText = button.textContent;
        button.textContent = "Sending...";
        button.disabled = true;
        button.classList.add("opacity-75", "cursor-not-allowed");

        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
          button.classList.remove("opacity-75", "cursor-not-allowed");
        }, 10000);
      });

      form.addEventListener("error", function (e) {
        console.error("Form submission error:", e);
        window.location.href = "/form-error";
      });
    }
  });
</script>

