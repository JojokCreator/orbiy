---
import { storyblokEditable } from "@storyblok/astro";
import { getCollection } from "astro:content";
import Button from "../components/reusable/Button.astro";
import FeaturedCarCard from "../components/FeaturedCarCard.astro";

const { blok } = Astro.props;
const { title, header, featured_cars_button } = blok;

// Get featured cars from the content collection
const allCars = await getCollection("cars");
const featuredCars = allCars.filter((car) => car.data.featured);
---

<section {...storyblokEditable(blok)} class="site-container vertical-p">
    <div>
        <p class="text-blue-gray font-semibold pb-2 md:pb-4">{header}</p>
        <hr class="border-t border-blue-gray h-1 w-full pb-6 md:pb-8" />
        <div>
            <h2 class="text-gray">
                {title}
            </h2>

            <!-- Featured Cars Grid -->
            {
                featuredCars.length > 0 && (
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {featuredCars.map((car) => (
                            <FeaturedCarCard car={car} />
                        ))}
                    </div>
                )
            }

            {
                featured_cars_button && featured_cars_button.length > 0 && (
                    <div class="mt-6 md:mt-12">
                        <Button
                            type="filledDark"
                            buttonText={featured_cars_button[0].text}
                            link={featured_cars_button[0].link?.url}
                        />
                    </div>
                )
            }
        </div>
    </div>
</section>
