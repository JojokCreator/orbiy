---
import { storyblokEditable } from "@storyblok/astro";
import { getImage } from "astro:assets";
import Button from "../components/reusable/Button.astro";

const { blok } = Astro.props;
const { header, title, text, button, image, image_side } = blok;

// Get optimized image
let optimizedImage = "";
if (image?.filename) {
  const { src } = await getImage({
    src: image.filename,
    format: "webp",
    quality: 80,
    width: 600,
    height: 400,
  });
  optimizedImage = src;
}

// Determine layout classes based on image position
const layoutClasses = image_side === "right"
  ? "lg:flex-row-reverse"
  : "lg:flex-row";
---

<section
  {...storyblokEditable(blok)}
  class="py-12 md:py-16 lg:py-20 bg-white"
>
  <div class="site-container">
    <div class={`grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center ${layoutClasses}`}>
      {/* Content Side */}
      <div class="space-y-6">
        {header && (
          <p class="text-blue-gray font-semibold text-lg md:text-xl">
            {header}
          </p>
        )}

        {title && (
          <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-black leading-tight">
            {title}
          </h2>
        )}

        {text && (
          <div class="prose prose-lg max-w-none">
            <p class="text-gray text-lg leading-relaxed">
              {text}
            </p>
          </div>
        )}

        {button && button.length > 0 && (
          <div class="pt-4">
            <Button
              type={button[0].style || "filled"}
              buttonText={button[0].text}
              link={button[0].link?.cached_url || "#"}
              class="inline-flex"
            />
          </div>
        )}
      </div>

      {/* Image Side */}
      <div class="order-first lg:order-none">
        {image?.filename ? (
          <img
            src={optimizedImage}
            alt={image.alt || title || "Image"}
            class="w-full h-auto rounded-lg shadow-lg object-cover"
            width={600}
            height={400}
            loading="lazy"
          />
        ) : (
          <div class="w-full h-64 md:h-80 lg:h-96 bg-gray-200 rounded-lg flex items-center justify-center">
            <span class="text-gray-500">Image Coming Soon</span>
          </div>
        )}
      </div>
    </div>
  </div>
</section>