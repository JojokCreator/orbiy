---
import { storyblokEditable, renderRichText } from "@storyblok/astro";
import { getImage } from "astro:assets";
import Button from "../components/reusable/Button.astro";

const { blok } = Astro.props;
const { background_image, title, features, features_button } = blok;

// Get optimized background image
let backgroundImageUrl = "";
if (background_image?.filename) {
  const { src } = await getImage({
    src: background_image.filename,
    format: "webp",
    quality: 80,
    width: 1920,
    height: 1080,
  });
  backgroundImageUrl = src;
}
---

<section
  class="relative w-screen overflow-hidden bg-black vertical-p"
  style={`background-image: url('${backgroundImageUrl}'); background-size: cover; background-position: center; background-repeat: no-repeat;`}
  {...storyblokEditable(blok)}
>
  <div class="site-container">
    <div
      class="flex-0 w-full lg:w-1/2 lg:ml-auto bg-teal/80 p-6 sm:p-8 rounded-sm"
    >
      <div
        class="pb-6 border-b border-white text-white"
        set:html={renderRichText(title)}
      />
      <div>
        {
          features?.map((feature: { title: string; description: string }) => (
            <div class="flex items-start space-x-4">
              <div class="flex-1 border-b border-white py-6">
                <p class="text-white mb-2 text-lg sm:text-xl font-medium">
                  {feature.title}
                </p>
                <p class="text-white text-sm sm:text-base">
                  {feature.description}
                </p>
              </div>
            </div>
          ))
        }
      </div>
      {
        features_button && features_button.length > 0 && (
          <div class="mt-8">
            <Button
              type={features_button[0].style}
              buttonText={features_button[0].text}
              link={"/" + features_button[0].link.cached_url}
            />
          </div>
        )
      }
    </div>
  </div>
</section>
